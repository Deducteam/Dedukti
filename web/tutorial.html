<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-03-29 mar. 17:30 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title>Dedukti Tutorial</title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Raphaël Cauderlier" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="tutorial.css" />
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="preamble" class="status">
<div id="preamble"><div id="container"><div id="header"><a href="index.html" title="Index"><img src="img/dedukti_logo.png" alt="Dedukti Logo" class="logo"></a></div><div id="main"><div id="empty">
</div>
<div id="content">
<h1 class="title">Dedukti Tutorial</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">1. Introduction</a></li>
<li><a href="#orgheadline6">2. Installation</a>
<ul>
<li><a href="#orgheadline2">2.1. Dedukti Installation</a></li>
<li><a href="#orgheadline5">2.2. Emacs Mode</a>
<ul>
<li><a href="#orgheadline3">2.2.1. Adding the MELPA Repository</a></li>
<li><a href="#orgheadline4">2.2.2. Installing Dedukti-mode</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline9">3. Getting started</a>
<ul>
<li><a href="#orgheadline7">3.1. The <code>#NAME</code> Line</a></li>
<li><a href="#orgheadline8">3.2. Comments</a></li>
</ul>
</li>
<li><a href="#orgheadline12">4. Natural Numbers</a>
<ul>
<li><a href="#orgheadline10">4.1. First Declarations and Definitions</a></li>
<li><a href="#orgheadline11">4.2. First Rewrite Rules</a></li>
</ul>
</li>
<li><a href="#orgheadline17">5. Simple Booleans</a>
<ul>
<li><a href="#orgheadline13">5.1. Booleans</a></li>
<li><a href="#orgheadline14">5.2. Equality</a></li>
<li><a href="#orgheadline15">5.3. Testing</a></li>
<li><a href="#orgheadline16">5.4. Testing by type-checking with a dependent type</a></li>
</ul>
</li>
<li><a href="#orgheadline18">6. Lists</a></li>
<li><a href="#orgheadline20">7. Partial Functions</a></li>
<li><a href="#orgheadline21">8. Integers and Smart Constructors</a></li>
<li><a href="#orgheadline19">9. Vectors and Dependent Types</a></li>
<li><a href="#orgheadline24">10. Non-linear Rewriting</a>
<ul>
<li><a href="#orgheadline22">10.1. Partial Equality</a></li>
<li><a href="#orgheadline23">10.2. Extending a decidable Equality modulo Conversion</a></li>
</ul>
</li>
<li><a href="#orgheadline27">11. Symmetric Definitions</a>
<ul>
<li><a href="#orgheadline25">11.1. A Theorem about Vectors</a></li>
<li><a href="#orgheadline26">11.2. Confluence</a></li>
</ul>
</li>
<li><a href="#orgheadline28">12. Correct by Confluence</a></li>
<li><a href="#orgheadline29">13. Conclusion</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1"><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
This is a tutorial for the Dedukti type-checker.
It is not a manual for Dedukti (which is available <a href="../manual_v2_5.html">here</a>)
nor an exhaustive list of Dedukti features.
</p>

<p>
Compared to similar software such as Coq and Twelf, Dedukti has two
main differences:
</p>
<ul class="org-ul">
<li>Dedukti is based on rewriting, a very powerful mechanism which can
be used to discharge the computational part of proofs to the
type-checker.</li>
<li>Dedukti is a type-checker, not a proof assistant; it has been
designed for checking machine-generated proofs and it does not
contain features whose sole purpose is to help human users
(tactics and mechanisms for trying to fill gaps automatically for
example).</li>
</ul>

<p>
However, since writing a Dedukti generator usually starts with
manually defining its logic in Dedukti, it is often necessary to
learn how to write Dedukti code directly.  This tutorial is a
starting point to achieve this.
</p>
</div>
</div>

<div id="outline-container-orgheadline6" class="outline-2">
<h2 id="orgheadline6"><span class="section-number-2">2</span> Installation</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2"><span class="section-number-3">2.1</span> Dedukti Installation</h3>
<div class="outline-text-3" id="text-2-1">
<p>
Dedukti installation is described in the <a href="../manual_v2_5.html">manual</a>. This tutorial has been written for Dedukti version 2.5.
</p>
</div>
</div>
<div id="outline-container-orgheadline5" class="outline-3">
<h3 id="orgheadline5"><span class="section-number-3">2.2</span> Emacs Mode</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Dedukti code can conveniently be edited
using the text editor GNU Emacs.
For Emacs version 24 and more,
the Emacs mode for Dedukti can be installed
through Emacs package manager.
</p>
</div>
<div id="outline-container-orgheadline3" class="outline-4">
<h4 id="orgheadline3"><span class="section-number-4">2.2.1</span> Adding the MELPA Repository</h4>
<div class="outline-text-4" id="text-2-2-1">
<p>
Dedukti-mode is hosted on the MELPA repository, to allow MELPA,
add the following line to your Emacs configuration file:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-to-list package-archives '(<span style="color: #4E9A06;">"melpa"</span> . <span style="color: #4E9A06;">"http://melpa.milkbox.net/packages/"</span>))
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline4" class="outline-4">
<h4 id="orgheadline4"><span class="section-number-4">2.2.2</span> Installing Dedukti-mode</h4>
<div class="outline-text-4" id="text-2-2-2">
<p>
To install Dedukti-mode, type the following command:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">M-x package-install &lt;RET&gt; dedukti-mode
</pre>
</div>
<p>
The <code>flycheck</code> tool is aware of Dedukti;
it can be installed by the following command:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">M-x package-install &lt;RET&gt; flycheck-dedukti
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline9" class="outline-2">
<h2 id="orgheadline9"><span class="section-number-2">3</span> Getting started</h2>
<div class="outline-text-2" id="text-3">
</div><div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7"><span class="section-number-3">3.1</span> The <code>#NAME</code> Line</h3>
<div class="outline-text-3" id="text-3-1">
<p>
To get started, visit (open) a new file with the <code>.dk</code> extension,
say <code>foo.dk</code>.
Emacs should select <code>dedukti-mode</code> for the buffer major mode
and indicate this by the string "Dedukti" in the mode line.
If flycheck is enabled,
it indicates that the buffer is not accepted by Dedukti
with the following error message: <code>Unexpected token ''.</code>.
</p>

<p>
A Dedukti file should always start with a line
of the form <code>#NAME &lt;module_name&gt;.</code>
where <code>&lt;module_name&gt;</code> is the name of the module beeing defined by the file.
This name will be used to refer to constants and functions
defined in the file from other Dedukti developments.
If the file is named <code>foo.dk</code>
then <code>foo</code> is a good candidate for the module name.
</p>

<div class="exercise">
<p>
Add the following line:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #006400; font-weight: bold;">#NAME foo</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>

</div>
</div>
</div>

<div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8"><span class="section-number-3">3.2</span> Comments</h3>
<div class="outline-text-3" id="text-3-2">
<p>
In Dedukti, comments are enclosed by "(;" and ";)".
In Emacs, these can be inserted by typing <code>M-;</code>.
</p>

<p>
Add a comment at the beggining of your file.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline12" class="outline-2">
<h2 id="orgheadline12"><span class="section-number-2">4</span> Natural Numbers</h2>
<div class="outline-text-2" id="text-4">
</div><div id="outline-container-orgheadline10" class="outline-3">
<h3 id="orgheadline10"><span class="section-number-3">4.1</span> First Declarations and Definitions</h3>
<div class="outline-text-3" id="text-4-1">
<p>
To define Peano natural numbers, we need to declare 3 constants:
</p>
<ul class="org-ul">
<li>A type <code>Nat</code>, the type of natural numbers;</li>
<li>A constant <code>0</code> of type <code>Nat</code>,</li>
<li>A constant <code>S</code> of type <code>Nat</code> &rarr; <code>Nat</code>, the successor function.</li>
</ul>

<p>
Note that digits are considered regular letters in Dedukti
so <code>0</code> is a valid identifier.
</p>

<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #00578E; font-weight: bold;">Nat :</span> <span style="color: #A52A2A; font-weight: bold;">Type.</span>
<span style="color: #00578E; font-weight: bold;">0 :</span> <span style="color: #0084C8; font-weight: bold;">Nat</span><span style="color: #A52A2A; font-weight: bold;">.</span>
<span style="color: #00578E; font-weight: bold;">S :</span> <span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Nat</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>

<p>
We can define <code>1</code> as the successor of <code>0</code>, <code>2</code> as the successor of
<code>1</code>, etc…:
</p>

<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #0084C8; font-weight: bold;">1</span> <span style="color: #A52A2A; font-weight: bold;">:=</span> <span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">0</span><span style="color: #A52A2A; font-weight: bold;">.</span>
<span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #0084C8; font-weight: bold;">2</span> <span style="color: #A52A2A; font-weight: bold;">:=</span> <span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">1</span><span style="color: #A52A2A; font-weight: bold;">.</span>
<span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #0084C8; font-weight: bold;">3</span> <span style="color: #A52A2A; font-weight: bold;">:=</span> <span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">2</span><span style="color: #A52A2A; font-weight: bold;">.</span>
<span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #0084C8; font-weight: bold;">4</span> <span style="color: #A52A2A; font-weight: bold;">:=</span> <span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">3</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>

<p>
We can also ask Emacs to generate these definitions for us:
</p>
<div class="org-src-container">

<pre class="src src-emacs-lisp">M-: (<span style="color: #A52A2A; font-weight: bold;">dotimes</span> (i 100) (insert (format <span style="color: #4E9A06;">"def %d := S %d.\n"</span> (+ 1 i) i)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline11" class="outline-3">
<h3 id="orgheadline11"><span class="section-number-3">4.2</span> First Rewrite Rules</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Peano addition can be defined as follow:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">0 + n = n</td>
</tr>

<tr>
<td class="org-left">(m+1) + n = (m + n) + 1</td>
</tr>
</tbody>
</table>
<p>
In Dedukti, this recursive definition can be written like this:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">plus : </span><span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Nat</span><span style="color: #A52A2A; font-weight: bold;">.</span>
[<span style="color: #0084C8; font-weight: bold;">n</span>] <span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #0084C8; font-weight: bold;">0</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">n</span>
[<span style="color: #0084C8; font-weight: bold;">m</span><span style="color: #A52A2A; font-weight: bold;">,</span><span style="color: #0084C8; font-weight: bold;">n</span>] <span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">m</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #0084C8; font-weight: bold;">m</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">).</span>
</pre>
</div>
<p>
The first line is the declaration of the symbol <code>plus</code>, the
following lines are rewrite rules defining the function <code>plus</code> by
pattern-matching on its first argument.  The keyword <code>def</code> starting
the declaration of <code>plus</code> indicates that the symbol <code>plus</code> is
allowed to appear at the head of rewrite rules.  The names
appearing inside the brackets at the left of each rule are the
variables to be substituted for applying the rewrite rule.
</p>

<div class="exercise">
<p>
Define the multiplication <code>mult</code> using the following definition:
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">0 × n = 0</td>
</tr>

<tr>
<td class="org-left">(m+1) × n = (m × n) + n</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline17" class="outline-2">
<h2 id="orgheadline17"><span class="section-number-2">5</span> Simple Booleans</h2>
<div class="outline-text-2" id="text-5">
</div><div id="outline-container-orgheadline13" class="outline-3">
<h3 id="orgheadline13"><span class="section-number-3">5.1</span> Booleans</h3>
<div class="outline-text-3" id="text-5-1">
<p>
As we defined addition, we can define equality of natural numbers
but we first need to define booleans:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #00578E; font-weight: bold;">Bool :</span> <span style="color: #A52A2A; font-weight: bold;">Type.</span>
<span style="color: #00578E; font-weight: bold;">True :</span> <span style="color: #0084C8; font-weight: bold;">Bool</span><span style="color: #A52A2A; font-weight: bold;">.</span>
<span style="color: #00578E; font-weight: bold;">False :</span> <span style="color: #0084C8; font-weight: bold;">Bool</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>
</div>
</div>
<div id="outline-container-orgheadline14" class="outline-3">
<h3 id="orgheadline14"><span class="section-number-3">5.2</span> Equality</h3>
<div class="outline-text-3" id="text-5-2">
<p>
Equality of natural numbers is defined by pattern-matching on both
arguments, the pattern <code>_</code> represents any term which we do not need
to name, this pattern can only appear in the left-hand side of
rewrite rules:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">equal : </span><span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Bool</span><span style="color: #A52A2A; font-weight: bold;">.</span>
[] <span style="color: #0084C8; font-weight: bold;">equal</span> <span style="color: #0084C8; font-weight: bold;">0</span> <span style="color: #0084C8; font-weight: bold;">0</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">True</span>
[] <span style="color: #0084C8; font-weight: bold;">equal</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">_</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #0084C8; font-weight: bold;">0</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">False</span>
[] <span style="color: #0084C8; font-weight: bold;">equal</span> <span style="color: #0084C8; font-weight: bold;">0</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">_</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">False</span>
[<span style="color: #0084C8; font-weight: bold;">m</span><span style="color: #A52A2A; font-weight: bold;">,</span><span style="color: #0084C8; font-weight: bold;">n</span>] <span style="color: #0084C8; font-weight: bold;">equal</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">m</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">equal</span> <span style="color: #0084C8; font-weight: bold;">m</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>

<div class="exercise">
<p>
Define a function <code>leq : Nat -&gt; Nat -&gt; Bool</code>
such that <code>leq n m</code> is <code>True</code> if <code>n</code> ≤ <code>m</code> and <code>False</code> if <code>n</code> &gt; <code>m</code>.
</p>

</div>
</div>
</div>

<div id="outline-container-orgheadline15" class="outline-3">
<h3 id="orgheadline15"><span class="section-number-3">5.3</span> Testing</h3>
<div class="outline-text-3" id="text-5-3">
<p>
In order to test our function,
we want to check that <code>mult</code> 10 10 is equal to 100.
</p>

<p>
This means that the term <code>equal (mult 10 10) 100</code>
reduces to the normal form <code>True</code>.
</p>

<p>
For a quick test, we can ask Emacs and Dedukti to evaluate a term;
if you select the term <code>equal (mult 10 10) 100</code>
anywhere after the definitions of <code>mult</code> and <code>equal</code>,
even in a comment,
you can run the Emacs command <code>M-x dedukti-snf</code>
which prints the normal form of the selected term in the echo area.
</p>

<p>
The commands dedukti-wnf, dedukti-hnf and dedukti-step are similar
but print respectively the weak normal form, the head-normal-form
and the term reduced by just one step.
</p>

<div class="exercise">
<p>
Check that the strong normal form of <code>equal (mult 10 10) 100</code> is True.
</p>

</div>

<div class="exercise">
<p>
Test your <code>leq</code> function on the following examples:
</p>
<ul class="org-ul">
<li><code>leq 50 100</code> ↪* <code>True</code></li>
<li><code>leq 100 50</code> ↪* <code>False</code></li>
<li><code>leq 100 100</code> ↪* <code>True</code></li>
</ul>

</div>
</div>
</div>

<div id="outline-container-orgheadline16" class="outline-3">
<h3 id="orgheadline16"><span class="section-number-3">5.4</span> Testing by type-checking with a dependent type</h3>
<div class="outline-text-3" id="text-5-4">
<p>
If you don't want to use Emacs,
it is also possible to use Dedukti type-checking to check
if a boolean is <code>True</code>:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #00578E; font-weight: bold;">Istrue :</span> <span style="color: #0084C8; font-weight: bold;">Bool</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #A52A2A; font-weight: bold;">Type.</span>
<span style="color: #00578E; font-weight: bold;">tt :</span> <span style="color: #0084C8; font-weight: bold;">Istrue</span> <span style="color: #0084C8; font-weight: bold;">True</span><span style="color: #A52A2A; font-weight: bold;">.</span>
<span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">test1 : </span><span style="color: #0084C8; font-weight: bold;">Istrue</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">equal</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">mult</span> <span style="color: #0084C8; font-weight: bold;">10</span> <span style="color: #0084C8; font-weight: bold;">10</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #0084C8; font-weight: bold;">100</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #A52A2A; font-weight: bold;">:=</span> <span style="color: #0084C8; font-weight: bold;">tt</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>

<p>
Istrue is neither a type like <code>Nat</code> and <code>Bool</code> nor a function,
it is a family of types indexed by a boolean;
this is called a <b>dependent type</b>.
</p>

<p>
There is no term of type <code>Istrue False</code>
and <code>tt</code> is the only term of type <code>Istrue True</code>.
</p>

<p>
The line <code>def test1 : Istrue (equal (mult 10 10) 100) :</code> <code>tt.</code>
defines the symbol <code>test1</code> of type <code>Istrue (equal (mult 10 10) 100)</code>
by the term <code>tt</code>.
Dedukti will accept this definition
only if <code>test1</code> and <code>tt</code> have the same type,
so this definition will be accepted only if <code>equal (mult 10 10) 100</code>
and <code>True</code> are convertible terms.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline18" class="outline-2">
<h2 id="orgheadline18"><span class="section-number-2">6</span> Lists</h2>
<div class="outline-text-2" id="text-6">
<p>
Lists over a fixed type <code>A</code> can be defined very similarly to natural numbers:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #00578E; font-weight: bold;">List :</span> <span style="color: #A52A2A; font-weight: bold;">Type.</span>
<span style="color: #00578E; font-weight: bold;">Nil :</span> <span style="color: #0084C8; font-weight: bold;">List</span><span style="color: #A52A2A; font-weight: bold;">.</span>
<span style="color: #00578E; font-weight: bold;">Cons :</span> <span style="color: #0084C8; font-weight: bold;">A</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">List</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">List</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>

<p>
Here is an example of a function working on lists:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">append : </span><span style="color: #0084C8; font-weight: bold;">List</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">List</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">List</span><span style="color: #A52A2A; font-weight: bold;">.</span>
[ <span style="color: #00578E; font-weight: bold;">l2 : </span><span style="color: #0084C8; font-weight: bold;">List</span> ] <span style="color: #0084C8; font-weight: bold;">append</span> <span style="color: #0084C8; font-weight: bold;">Nil</span> <span style="color: #0084C8; font-weight: bold;">l2</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">l2</span>
[ <span style="color: #00578E; font-weight: bold;">a : </span><span style="color: #0084C8; font-weight: bold;">A</span><span style="color: #A52A2A; font-weight: bold;">,</span> <span style="color: #00578E; font-weight: bold;">l1 : </span><span style="color: #0084C8; font-weight: bold;">List</span><span style="color: #A52A2A; font-weight: bold;">,</span> <span style="color: #00578E; font-weight: bold;">l2 : </span><span style="color: #0084C8; font-weight: bold;">List</span> ] <span style="color: #0084C8; font-weight: bold;">append</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">Cons</span> <span style="color: #0084C8; font-weight: bold;">a</span> <span style="color: #0084C8; font-weight: bold;">l1</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #0084C8; font-weight: bold;">l2</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">Cons</span> <span style="color: #0084C8; font-weight: bold;">a</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">append</span> <span style="color: #0084C8; font-weight: bold;">l1</span> <span style="color: #0084C8; font-weight: bold;">l2</span><span style="color: #A52A2A; font-weight: bold;">).</span>
</pre>
</div>

<div class="exercise">
<p>
Define a function <code>length</code> with the following signature:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">length : </span><span style="color: #0084C8; font-weight: bold;">List</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Nat</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>
<p>
such that <code>length l</code> reduces to the number of elements of the list <code>l</code>.
</p>

</div>
</div>
</div>

<div id="outline-container-orgheadline20" class="outline-2">
<h2 id="orgheadline20"><span class="section-number-2">7</span> Partial Functions</h2>
<div class="outline-text-2" id="text-7">
<p>
Dedukti doesn't check for exhaustivity of pattern-matching;
this allows us to write partial functions
like the predecessor function on natural numbers:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">pred : </span><span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Nat</span><span style="color: #A52A2A; font-weight: bold;">.</span>
[ <span style="color: #00578E; font-weight: bold;">n : </span><span style="color: #0084C8; font-weight: bold;">Nat</span> ] <span style="color: #0084C8; font-weight: bold;">pred</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>

<p>
The term <code>pred 0</code> is a well-typed term of type <code>Nat</code>
which is neither <code>0</code> nor of the form <code>S n</code>.
Hence it won't be useful in computations.
</p>

<div class="exercise">
<p>
Define two functions <code>head</code> and <code>tail</code> with the following signatures:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">head : </span><span style="color: #0084C8; font-weight: bold;">List</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">A</span><span style="color: #A52A2A; font-weight: bold;">.</span>
<span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">tail : </span><span style="color: #0084C8; font-weight: bold;">List</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">List</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>
<p>
<code>head l</code> should reduce to the first element of the list <code>l</code>
and <code>tail l</code> to the list compsed of the other elements.
</p>

</div>

<p>
As we will see in <a href="#orgheadline19">9</a>,
it is also possible to define lists
in a way that forbids the terms <code>tail Nil</code> and <code>head Nil</code>.
</p>
</div>
</div>

<div id="outline-container-orgheadline21" class="outline-2">
<h2 id="orgheadline21"><span class="section-number-2">8</span> Integers and Smart Constructors</h2>
<div class="outline-text-2" id="text-8">
<p>
Integers may be defined by differences of natural numbers,
using a single constructor <code>Diff</code> of type <code>Nat</code> &rarr; <code>Nat</code> &rarr; <code>Int</code>.
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #00578E; font-weight: bold;">Int :</span> <span style="color: #A52A2A; font-weight: bold;">Type.</span>
<span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">Diff : </span><span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Int</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>
<p>
But we also want to identify equal integers
so we add the following rule:
</p>
<div class="org-src-container">

<pre class="src src-dedukti">[<span style="color: #0084C8; font-weight: bold;">m</span><span style="color: #A52A2A; font-weight: bold;">,</span><span style="color: #0084C8; font-weight: bold;">n</span>] <span style="color: #0084C8; font-weight: bold;">Diff</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">m</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">Diff</span> <span style="color: #0084C8; font-weight: bold;">m</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>
<p>
So the only possible normal forms of type <code>Int</code> are
</p>
<ul class="org-ul">
<li><code>Diff 0 0</code>, representing the integer 0,</li>
<li><code>Diff (S n) 0</code> for some <code>n : Nat</code>, representing the integer n+1,</li>
<li><code>Diff 0 (S n)</code> for some <code>n : Nat</code>, representing the integer -(n+1).</li>
</ul>

<div class="exercise">
<p>
Define a function <code>abs</code> with the following signature:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">abs : </span><span style="color: #0084C8; font-weight: bold;">Int</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Nat</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>
<p>
Such that <code>abs n</code> reduces to the absolute value of <code>n</code>.
</p>

</div>

<p>
The constructor <code>Diff</code> is in fact a partial function
because it reduces on some inputs (when both arguments are successors)
but not all inputs.
</p>

<p>
However, irreducible terms of the form <code>Diff m n</code> are not considered
bad terms but constructed values.
</p>

<p>
A constructor like <code>Diff</code> on which rewrite rules are added
is called a <b>smart constructor</b>.
</p>

<p>
Please note that the notions of constructor,
value and smart constructor have no meaning for Dedukti,
they are just interpretations of the roles
that are played by some symbols and normal forms.
</p>
</div>
</div>
<div id="outline-container-orgheadline19" class="outline-2">
<h2 id="orgheadline19"><span class="section-number-2">9</span> Vectors and Dependent Types</h2>
<div class="outline-text-2" id="text-9">
<p>
Some functions on lists can be partially specified
by their action on the length of the list;
this can be reflected at the type level
by making the type of lists dependent on the length of the list.
Lists depending on their length are usually called vectors.
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #00578E; font-weight: bold;">Vector :</span> <span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #A52A2A; font-weight: bold;">Type.</span>

<span style="color: #00578E; font-weight: bold;">vector_nil :</span> <span style="color: #0084C8; font-weight: bold;">Vector</span> <span style="color: #0084C8; font-weight: bold;">0</span><span style="color: #A52A2A; font-weight: bold;">.</span>
<span style="color: #00578E; font-weight: bold;">vector_cons :</span> <span style="color: #00578E; font-weight: bold;">n : </span><span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">A</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Vector</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Vector</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">).</span>
</pre>
</div>

<p>
The type <code>Vector n</code> is the type of vectors of length <code>n</code>.
A vector can be built like a list
except that an extra argument has to be passed to <code>vector_cons</code>
specifying the length of the tail of the vector.
</p>

<p>
Vectors allow us to write safe versions of the destructors <code>head</code> and <code>tail</code>:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">vector_head : n : </span><span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Vector</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">A</span><span style="color: #A52A2A; font-weight: bold;">.</span>
<span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">vector_tail : n : </span><span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Vector</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Vector</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">.</span>
[ <span style="color: #00578E; font-weight: bold;">n : </span><span style="color: #0084C8; font-weight: bold;">Nat</span><span style="color: #A52A2A; font-weight: bold;">,</span> <span style="color: #00578E; font-weight: bold;">a : </span><span style="color: #0084C8; font-weight: bold;">A</span><span style="color: #A52A2A; font-weight: bold;">,</span> <span style="color: #00578E; font-weight: bold;">l : </span><span style="color: #0084C8; font-weight: bold;">Vector</span> <span style="color: #0084C8; font-weight: bold;">n</span> ]
    <span style="color: #0084C8; font-weight: bold;">vector_head</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">vector_cons</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #0084C8; font-weight: bold;">a</span> <span style="color: #0084C8; font-weight: bold;">l</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">a</span><span style="color: #A52A2A; font-weight: bold;">.</span>
[ <span style="color: #00578E; font-weight: bold;">n : </span><span style="color: #0084C8; font-weight: bold;">Nat</span><span style="color: #A52A2A; font-weight: bold;">,</span> <span style="color: #00578E; font-weight: bold;">a : </span><span style="color: #0084C8; font-weight: bold;">A</span><span style="color: #A52A2A; font-weight: bold;">,</span> <span style="color: #00578E; font-weight: bold;">l : </span><span style="color: #0084C8; font-weight: bold;">Vector</span> <span style="color: #0084C8; font-weight: bold;">n</span> ]
    <span style="color: #0084C8; font-weight: bold;">vector_tail</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">vector_cons</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #0084C8; font-weight: bold;">a</span> <span style="color: #0084C8; font-weight: bold;">l</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">l</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>

<div class="exercise">
<p>
Define a function <code>vector_append</code> with the following signature:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">vector_append : m : </span><span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #00578E; font-weight: bold;">n : </span><span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Vector</span> <span style="color: #0084C8; font-weight: bold;">m</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Vector</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Vector</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #0084C8; font-weight: bold;">m</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">).</span>
</pre>
</div>
<p>
computing vector concatenation.
</p>

</div>
</div>
</div>

<div id="outline-container-orgheadline24" class="outline-2">
<h2 id="orgheadline24"><span class="section-number-2">10</span> Non-linear Rewriting</h2>
<div class="outline-text-2" id="text-10">
</div><div id="outline-container-orgheadline22" class="outline-3">
<h3 id="orgheadline22"><span class="section-number-3">10.1</span> Partial Equality</h3>
<div class="outline-text-3" id="text-10-1">
<p>
If we want to define equality on lists or vectors, we need a way to compare elements
but we don't have any constructor of type <code>A</code> yet.
</p>

<p>
However, we can partially define equality over <code>A</code> in the positive case:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">A_eq : </span><span style="color: #0084C8; font-weight: bold;">A</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">A</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Bool</span><span style="color: #A52A2A; font-weight: bold;">.</span>
[<span style="color: #0084C8; font-weight: bold;">a</span>] <span style="color: #0084C8; font-weight: bold;">A_eq</span> <span style="color: #0084C8; font-weight: bold;">a</span> <span style="color: #0084C8; font-weight: bold;">a</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">True</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>

<p>
This rule is said to be <b>non-linear</b> because the free variable <code>a</code>
appears twice in the left-hand side pattern.  By default, Dedukti
rejects non-linear rewrite rules; the option <code>-nl</code> can be passed to
<code>dkcheck</code> to allow them.
</p>

<div class="exercise">
<p>
Define the equalities over lists and vectors using <code>A_eq</code> and test them.
</p>

</div>
</div>
</div>

<div id="outline-container-orgheadline23" class="outline-3">
<h3 id="orgheadline23"><span class="section-number-3">10.2</span> Extending a decidable Equality modulo Conversion</h3>
<div class="outline-text-3" id="text-10-2">
<p>
We can also extend the equality over natural numbers by a similar non-linear rule:
</p>
<div class="org-src-container">

<pre class="src src-dedukti">[ <span style="color: #00578E; font-weight: bold;">n : </span><span style="color: #0084C8; font-weight: bold;">Nat</span> ] <span style="color: #0084C8; font-weight: bold;">equal</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">True</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>

<p>
With this extra rule,
we will be able to consider
that convertible terms of type <code>Nat</code> are equal
even if they are not of the form <code>0</code> or <code>S n</code>;
for example, <code>equal (pred 0) (pred 0)</code>
and <code>equal (plus n n) (plus n n)</code> for an abstract <code>n</code>
will both reduce to <code>True</code>.
</p>

<div class="exercise">
<p>
Extend equalities over lists and vectors by a non-linear rule.
</p>

</div>
</div>
</div>
</div>
<div id="outline-container-orgheadline27" class="outline-2">
<h2 id="orgheadline27"><span class="section-number-2">11</span> Symmetric Definitions</h2>
<div class="outline-text-2" id="text-11">
</div><div id="outline-container-orgheadline25" class="outline-3">
<h3 id="orgheadline25"><span class="section-number-3">11.1</span> A Theorem about Vectors</h3>
<div class="outline-text-3" id="text-11-1">
<p>
Using Curry-De Brujn-Howard isomorphism,
we can see Dedukti types as propositions
(in First-Order Minimal Logic)
and terms as proofs.
</p>

<p>
For example, the theorem stating that <code>0</code> is
right-neutral for addition can be stated and proved in Dedukti like this:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">0_right_neutral : n : </span><span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span>
                      <span style="color: #0084C8; font-weight: bold;">Istrue</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">equal</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #0084C8; font-weight: bold;">0</span><span style="color: #A52A2A; font-weight: bold;">)).</span>
[] <span style="color: #0084C8; font-weight: bold;">0_right_neutral</span> <span style="color: #0084C8; font-weight: bold;">0</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">tt</span>
[<span style="color: #0084C8; font-weight: bold;">n</span>] <span style="color: #0084C8; font-weight: bold;">0_right_neutral</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">0_right_neutral</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>

<p>
However, we can not even state a theorem for right-neutrality of <code>vector_nil</code>
for <code>vector_assoc</code>;
if we try like this:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">vector_nil_right_neutral : n : </span><span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span>
<span style="color: #00578E; font-weight: bold;">                               l :</span> <span style="color: #0084C8; font-weight: bold;">List</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span>
                               <span style="color: #0084C8; font-weight: bold;">Istrue</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">vector_equal</span> <span style="color: #0084C8; font-weight: bold;">n</span>
                                        <span style="color: #0084C8; font-weight: bold;">l</span>
                                        <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">vector_assoc</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #0084C8; font-weight: bold;">0</span> <span style="color: #0084C8; font-weight: bold;">l</span> <span style="color: #0084C8; font-weight: bold;">vector_nil</span><span style="color: #A52A2A; font-weight: bold;">)).</span>
</pre>
</div>
<p>
dkcheck complains because <code>l</code> and <code>vector_assoc n 0 l vector_nil</code> do not have convertible types:
<code>l</code> has type <code>Vector n</code> while <code>vector_assoc n 0 l vector_nil</code> has type <code>Vector (plus n 0)</code>.
</p>

<p>
We know that <code>n</code> and <code>plus n 0</code> are provably equal but for an abstract <code>n</code>,
they are not convertible.
</p>

<p>
However, even for an abstract <code>n</code>, <code>n</code> and <code>plus 0 n</code> are convertible
and so are <code>l</code> and <code>vector_assoc n 0 vector_nil l</code>.
</p>

<p>
This asymmetry comes from an asymmetry in the definition of <code>plus</code> (which replicates on <code>vector_assoc</code>).
</p>

<p>
In most type systems, we have to choose between a left and a right
definition of Peano addition and then prove that the other
possibilty is equivalent.  In Dedukti we have a third option, a
symmetric definition of <code>plus</code>:
</p>
<div class="org-src-container">

<pre class="src src-dedukti"><span style="color: #A52A2A; font-weight: bold;">def</span> <span style="color: #00578E; font-weight: bold;">plus : </span><span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Nat</span> <span style="color: #A52A2A; font-weight: bold;">-&gt;</span> <span style="color: #0084C8; font-weight: bold;">Nat</span><span style="color: #A52A2A; font-weight: bold;">.</span>
[<span style="color: #0084C8; font-weight: bold;">n</span>] <span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #0084C8; font-weight: bold;">0</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">n</span>
[<span style="color: #0084C8; font-weight: bold;">m</span>] <span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #0084C8; font-weight: bold;">m</span> <span style="color: #0084C8; font-weight: bold;">0</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">m</span>
[<span style="color: #0084C8; font-weight: bold;">m</span><span style="color: #A52A2A; font-weight: bold;">,</span><span style="color: #0084C8; font-weight: bold;">n</span>] <span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #0084C8; font-weight: bold;">m</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #0084C8; font-weight: bold;">m</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">)</span>
[<span style="color: #0084C8; font-weight: bold;">m</span><span style="color: #A52A2A; font-weight: bold;">,</span><span style="color: #0084C8; font-weight: bold;">n</span>] <span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #0084C8; font-weight: bold;">m</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">S</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #0084C8; font-weight: bold;">m</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">).</span>
</pre>
</div>

<div class="exercise">
<p>
State and prove the <code>vector_nil_right_neutral</code> theorem.
</p>

</div>

<div class="exercise">
<p>
Redefine <code>vector_assoc</code> symmetrically.
</p>

</div>
</div>
</div>

<div id="outline-container-orgheadline26" class="outline-3">
<h3 id="orgheadline26"><span class="section-number-3">11.2</span> Confluence</h3>
<div class="outline-text-3" id="text-11-2">
<p>
We have seen that both non-exhaustive (partial functions)
and redundant pattern-matching are allowed and useful in Dedukti.
</p>

<p>
However, there are two requirements on the rewrite-system that are
not checked by Dedukti but needed for a decidable type-checking:
</p>
<ul class="org-ul">
<li>strong normalization: there should be no infinite sequence of
rewriting and &beta;-reduction</li>
<li>confluence: each term should have only one normal form.</li>
</ul>

<p>
The higher-order confluence prover <a href="http://cl-informatik.uibk.ac.at/software/csi/ho/">CSI<sup>ho</sup></a> can be used for automatic
checking the confluence of Dedukti rewrite-systems using the -cc
option (followed by the path to CSI<sup>ho</sup>) of <code>dkcheck</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline28" class="outline-2">
<h2 id="orgheadline28"><span class="section-number-2">12</span> Correct by Confluence</h2>
<div class="outline-text-2" id="text-12">
<p>
In the previous parts, we have seen extensions of rewrite-systems defining <code>equal</code> and <code>plus</code>
in order to enforce at the conversion level some properties of these functions:
reflexivity and right-neutrality of <code>0</code>.
</p>

<p>
We can also add the associativity of addition:
</p>
<div class="org-src-container">

<pre class="src src-dedukti">[<span style="color: #0084C8; font-weight: bold;">m</span><span style="color: #A52A2A; font-weight: bold;">,</span><span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">,</span><span style="color: #0084C8; font-weight: bold;">p</span>] <span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #0084C8; font-weight: bold;">m</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">)</span> <span style="color: #0084C8; font-weight: bold;">p</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #0084C8; font-weight: bold;">m</span> <span style="color: #A52A2A; font-weight: bold;">(</span><span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #0084C8; font-weight: bold;">p</span><span style="color: #A52A2A; font-weight: bold;">).</span>
</pre>
</div>

<p>
Associativity of <code>plus</code> at the conversion level is useful for stating
(or adding a rewrite-rule for) associativity of <code>vector_append</code>.
</p>

<p>
But even when we don't need a conversion test,
it may be interesting to add a rewrite-rule.
For example, monads can easily be defined in Dedukti
and the monadic laws can be defined as rewrite-rules.
</p>

<p>
When we choose to use a rewrite-rule instead of proving a theorem,
we ask all following terms, types, proofs and proposition to be
considered modulo this rule so we don't have to say explicitly when
we are using basic theorems like associativity of addition so our
proofs are shorter and can be automatically found more easily. This
technique is known as Deduction modulo.
</p>

<p>
An other advantage is that if we have an automatic way of checking
that our systems are confluent and strongly normalizing,
then we don't need to prove that <code>plus</code> is associative,
has <code>0</code> as right-neutral element etc…,
we have discharged this obligation to the confluence checker.
This is what we mean by the expression <b>correct by confluence</b>.
</p>

<div class="exercise">
<p>
All provably equal terms can not be made convertible
since equality is in general not decidable.
Explain while it is not possible to add the following rule
stating that addition is commutative:
</p>
<div class="org-src-container">

<pre class="src src-dedukti">[<span style="color: #0084C8; font-weight: bold;">m</span><span style="color: #A52A2A; font-weight: bold;">,</span><span style="color: #0084C8; font-weight: bold;">n</span>] <span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #0084C8; font-weight: bold;">n</span> <span style="color: #0084C8; font-weight: bold;">m</span> <span style="color: #A52A2A; font-weight: bold;">--&gt;</span> <span style="color: #0084C8; font-weight: bold;">plus</span> <span style="color: #0084C8; font-weight: bold;">m</span> <span style="color: #0084C8; font-weight: bold;">n</span><span style="color: #A52A2A; font-weight: bold;">.</span>
</pre>
</div>

</div>
</div>
</div>
<div id="outline-container-orgheadline29" class="outline-2">
<h2 id="orgheadline29"><span class="section-number-2">13</span> Conclusion</h2>
<div class="outline-text-2" id="text-13">
<p>
This tutorial was just an introduction to the Dedukti system and language
illustrating some interesting features.
Dedukti has successfully been used to encode computational calculi
and a large variety of logical systems.
Human-written Dedukti code can be found in dklib;
translators from several logical systems,
automated theorem provers backends for the Dedukti language
and Dedukti code source can be found on <a href="../index.html">Dedukti website</a>.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<div id="postamble"></div><div id="footer"><img src="img/deducteam.svg" alt="Deducteam" width="250px"><img src="img/logoinria.png" alt="INRIA" width="200px"></div></div>
</div>
</body>
</html>
