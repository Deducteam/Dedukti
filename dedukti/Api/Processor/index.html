<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Processor (dedukti.Api.Processor)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.0.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">dedukti</a> &#x00BB; <a href="../index.html">Api</a> &#x00BB; Processor</nav><header class="odoc-preamble"><h1>Module <code><span>Api.Processor</span></code></h1><p>A process module processes entries. It is parameterized by an environment.</p></header><nav class="odoc-toc"><ul><li><a href="#how-to-use-processors">How to use processors</a><ul><li><a href="#"></a></li><li><a href="#implement-its-own-processor">Implement its own processor</a><ul><li><a href="#define-processors-with-a-custom-environement">Define processors with a custom environement</a></li></ul></li></ul></li></ul></nav><div class="odoc-content"><h2 id="how-to-use-processors"><a href="#how-to-use-processors" class="anchor"></a>How to use processors</h2><p>As a user of the API of Dedukti, processors are the main entry point. The point of processors is to handle automatically inputs and files for you. The API of Dedukti has already defined 5 processors for you, but you are free to define more. This 5 processors are:</p><ul><li>TypeChecker : to type check the input</li><li>SignatureBuilder : to construct a signature without type checking it</li><li>Printer : to pretty print the input</li><li>Dependencies : Compute dependencies of the input</li><li>TopLevel : TypeCheck and prints and standard output</li></ul><p>Processors should be used through the methods:</p><ul><li>handle_input : to process one input</li><li>handle_files : to process a set of files</li><li>fold_files : to process a set of files and fold the results</li></ul><p>Mose of the time, we want to apply some operations before processing one file and some operations after. To do so, the API declares a type <code>hook</code> that can be given optionaly to the functions mentioned above. In particular, a hook allows to handle errors that may have been raised by the processor. By default, any error raised by the processor stops the execution of the processor and are pretty printed via the module <code>Errors</code>. This applies also for errors generated at parsing/scoping time for the functions which handle files.</p><p>We also recall that for <code>handle_input</code>, a processor consumes an <code>input</code>. As such, the <code>input</code> will not be reusable once it has been processed. This is because a Dedukti <code>input</code> is an abstraction for a stream of <code>Entry.entry</code>.</p><p>If you want to create your own processor, we invite you to go to Section </p><h3 id=""><a href="#" class="anchor"></a></h3><p>of this documentation.</p><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> <span>_ t</span></span><span> = </span><span>..</span></code></div><div class="spec-doc"><p>Each constructor corresponds to a processor. This type is extensible so that we can use this API with your own processors.</p></div></div><div class="odoc-spec"><div class="spec type extension" id="extension-decl-TypeChecker" class="anchored"><a href="#extension-decl-TypeChecker" class="anchor"></a><code><span><span class="keyword">type</span> <a href="#type-t">t</a> += </span></code><table><tr id="extension-TypeChecker" class="anchored"><td class="def extension"><a href="#extension-TypeChecker" class="anchor"></a><code><span>| </span><span><span class="extension">TypeChecker</span> : <span>unit <a href="#type-t">t</a></span></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>TypeCheck</p><span class="comment-delim">*)</span></td></tr><tr id="extension-SignatureBuilder" class="anchored"><td class="def extension"><a href="#extension-SignatureBuilder" class="anchor"></a><code><span>| </span><span><span class="extension">SignatureBuilder</span> : <span><a href="../../Kernel/Signature/index.html#type-t">Kernel.Signature.t</a> <a href="#type-t">t</a></span></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Build a signature without type checking</p><span class="comment-delim">*)</span></td></tr><tr id="extension-PrettyPrinter" class="anchored"><td class="def extension"><a href="#extension-PrettyPrinter" class="anchor"></a><code><span>| </span><span><span class="extension">PrettyPrinter</span> : <span>unit <a href="#type-t">t</a></span></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Pretty print</p><span class="comment-delim">*)</span></td></tr><tr id="extension-Dependencies" class="anchored"><td class="def extension"><a href="#extension-Dependencies" class="anchor"></a><code><span>| </span><span><span class="extension">Dependencies</span> : <span><a href="../Dep/index.html#type-t">Dep.t</a> <a href="#type-t">t</a></span></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>Compute dependencies</p><span class="comment-delim">*)</span></td></tr><tr id="extension-TopLevel" class="anchored"><td class="def extension"><a href="#extension-TopLevel" class="anchor"></a><code><span>| </span><span><span class="extension">TopLevel</span> : <span>unit <a href="#type-t">t</a></span></span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>TypeCheck and prints result on standard output</p><span class="comment-delim">*)</span></td></tr></table></div></div><div class="odoc-spec"><div class="spec type" id="type-processor_error" class="anchored"><a href="#type-processor_error" class="anchor"></a><code><span><span class="keyword">type</span> processor_error</span><span> = <a href="../Env/index.html#type-t">Env.t</a> * <a href="../../Kernel/Basic/index.html#type-loc">Kernel.Basic.loc</a> * exn</span></code></div><div class="spec-doc"><p>This is the type of errors returned by a processor</p></div></div><div class="odoc-spec"><div class="spec type" id="type-hook" class="anchored"><a href="#type-hook" class="anchor"></a><code><span><span class="keyword">type</span> hook</span><span> = </span><span>{</span></code><table><tr id="type-hook.before" class="anchored"><td class="def record field"><a href="#type-hook.before" class="anchor"></a><code><span>before : <span><a href="../Env/index.html#type-t">Env.t</a> <span class="arrow">&#45;&gt;</span></span> unit;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>hook_before is executed by the processor before processing the input</p><span class="comment-delim">*)</span></td></tr><tr id="type-hook.after" class="anchored"><td class="def record field"><a href="#type-hook.after" class="anchor"></a><code><span>after : <span><a href="../Env/index.html#type-t">Env.t</a> <span class="arrow">&#45;&gt;</span></span> <span><span><a href="#type-processor_error">processor_error</a> option</span> <span class="arrow">&#45;&gt;</span></span> unit;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>hook_after is executed by the processor after processing the output</p><span class="comment-delim">*)</span></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>To hook an input before and after it is being processed</p></div></div><div class="odoc-spec"><div class="spec module-type" id="module-type-Interface" class="anchored"><a href="#module-type-Interface" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> </span><span><a href="module-type-Interface/index.html">Interface</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-include"><details open="open"><summary class="spec include"><code><span><span class="keyword">include</span> <a href="module-type-Interface/index.html">Interface</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="module-type-Interface/index.html#type-t">t</a></span> := <span><span class="type-var">'a</span> <a href="#type-t">t</a></span></span></span></code></summary><div class="odoc-spec"><div class="spec value" id="val-handle_input" class="anchored"><a href="#val-handle_input" class="anchor"></a><code><span><span class="keyword">val</span> handle_input : <span><a href="../../Parsers/Parser/index.html#type-input">Parsers.Parser.input</a> <span class="arrow">&#45;&gt;</span></span> <span>?hook:<a href="#type-hook">hook</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>handle_input input hook processor</code> applies the processor <code>processor</code> on the <code>input</code>. <code>hook.hook_before</code> is executed once before the processor and <code>hook.hook_after</code> is executed once after the processor. By default (without hooks), if an exception <code>exn</code> has been raised while processing the data it is raised at top-level.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-handle_files" class="anchored"><a href="#val-handle_files" class="anchor"></a><code><span><span class="keyword">val</span> handle_files : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>?hook:<a href="#type-hook">hook</a> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span></span></code></div><div class="spec-doc"><p><code>handle_files files hook processor</code> apply a processor on each file of <code>files</code>. <code>hook</code> is used once by file. The result is the one given once each file has been processed.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-fold_files" class="anchored"><a href="#val-fold_files" class="anchor"></a><code><span><span class="keyword">val</span> fold_files : <span><span>string list</span> <span class="arrow">&#45;&gt;</span></span> <span>?hook:<a href="#type-hook">hook</a> <span class="arrow">&#45;&gt;</span></span> <span>f:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>default:<span class="type-var">'b</span> <span class="arrow">&#45;&gt;</span></span> <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'b</span></span></code></div></div></details></div><p><code>fold_files files fold default processor</code> is similar to <code>handle_files</code> except that the result of a processor is given to the function <code>fold</code> every time a file is processed.</p><h3 id="implement-its-own-processor"><a href="#implement-its-own-processor" class="anchor"></a>Implement its own processor</h3><p>The type <code>t</code> given above hides the complexity of a processor. Under the hood, a processor is actually a module of type <code>S</code> (see below). This module declares one type and two function. The type <code>S.t</code> is the type of the result computed by the processor. It is the same as <code>'a</code> in <code>'a t</code>, the type declared above. For example, the processor <code>Dependencies</code> as type <code>Deps.t t</code>. It is implemented by a module of type <code>S</code> where <code>S.t = Deps.t</code>.</p><p>A processor acts on top-level commands of Dedukti which are represented by the type <code>Parsers.Entry.entry</code> and are paremeterized by an environement <code>Env.t</code>. The module <code>Env</code> is the view of the API of the kernel of Dedukti. The type <code>Env.t</code> are paremeters for the kernel. In particular, it knows where to look for the next <code>entry</code>, how to reduce a term, how to type check a term etc...</p><p>Hence, a processor implements a function <code>handle_entry env entry</code> which is called successively on each entry (if no exception are triggered).</p><p>Finally, to get the result of a processor, we use the function <code>get_data env</code>.</p><p>These are the three things you need to define to declare a new processor. Once your processor has been defined, to be able to use the API above, you need to register you processor. The registration step is actually really easy. To register a processor, you need to do three things. 1. First, you need to extend the type <code>t</code> with a new constructor for your processor 2. Declare a trivial equality function for your new constructor (see below) 3. Call the Register function with your new constructor, your processor (as a module) and your equality function.</p><p>If you look at the type of the equality function and the register function it seems ugly. To understand how it works, we will give you an example. Assume your new processor is a module <code>Foo</code> such that <code>Foo.t = foo</code>. Then for the first step you do :</p><p>type _ t += Foo : foo t</p><p>For the second step you declare the following function</p><p>let equal_foo (type a b) : (a t * b t) -&gt; (a t,b t) Registration.equal option = function | Foo, Foo -&gt; Some (Registration.Refl (Foo)) | _ -&gt; None</p><p>For the third step you call the registration function this way :</p><p>let () = Registration.register_processor Foo <em>qual = equal_foo</em> (module Foo);</p><p>And then you are ready to go!</p><p>The current version allows you to shadow a previously known <code>Processor</code>, be careful with that.</p><p>Finally, in this section we declare an <code>of pure</code> function which allows you to define a processor by calling a function and without using the syntax of modules.</p><div class="odoc-spec"><div class="spec module-type" id="module-type-S" class="anchored"><a href="#module-type-S" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> </span><span><a href="module-type-S/index.html">S</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>The actual type of the processor as a module</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Registration" class="anchored"><a href="#module-Registration" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="Registration/index.html">Registration</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-get_processor" class="anchored"><a href="#val-get_processor" class="anchor"></a><code><span><span class="keyword">val</span> get_processor : <span><span><span class="type-var">'a</span> <a href="#type-t">t</a></span> <span class="arrow">&#45;&gt;</span></span> <span>(<span class="keyword">module</span> <a href="module-type-S/index.html">S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-S/index.html#type-t">t</a> = <span class="type-var">'a</span>)</span></span></code></div><div class="spec-doc"><p><code>get_processor processor</code> returns the module associated to the processor. Raise <code>Not_registered_processor</code> if the processor has not been registered.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-of_pure" class="anchored"><a href="#val-of_pure" class="anchor"></a><code><span><span class="keyword">val</span> of_pure : <span>f:<span>(<span><span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span><a href="../Env/index.html#type-t">Env.t</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="../../Parsers/Entry/index.html#type-entry">Parsers.Entry.entry</a> <span class="arrow">&#45;&gt;</span></span> <span class="type-var">'a</span>)</span> <span class="arrow">&#45;&gt;</span></span> <span>init:<span class="type-var">'a</span> <span class="arrow">&#45;&gt;</span></span> <span>(<span class="keyword">module</span> <a href="module-type-S/index.html">S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-S/index.html#type-t">t</a> = <span class="type-var">'a</span>)</span></span></code></div><div class="spec-doc"><p><code>of_pure ~f ~init</code> returns processor from the fold-like function <code>f</code>. <code>f acc
    env ent</code> folds entry <code>ent</code> on accumulator <code>acc</code> in environment <code>env</code>.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-T" class="anchored"><a href="#module-T" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="T/index.html">T</a></span><span> : <a href="module-type-Interface/index.html">Interface</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <span>'a <a href="module-type-Interface/index.html#type-t">t</a></span> := <span>(<span class="keyword">module</span> <a href="module-type-S/index.html">S</a> <span class="keyword">with</span> <span class="keyword">type</span> <a href="module-type-S/index.html#type-t">t</a> = <span class="type-var">'a</span>)</span></span></span></code></div></div><h4 id="define-processors-with-a-custom-environement"><a href="#define-processors-with-a-custom-environement" class="anchor"></a>Define processors with a custom environement</h4><p>It may be possible that for the default processors defined in this API, you want to use them with another module <code>Env</code> (for example for debugging or to hook yourself in one of the functions declared by the module). This is possible using the functors below. For your custom processors, this is not needed because you can already do it. The only requirement is to keep the same <code>Env.t</code> type.</p><div class="odoc-spec"><div class="spec module-type" id="module-type-CustomEnv" class="anchored"><a href="#module-type-CustomEnv" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> </span><span><a href="module-type-CustomEnv/index.html">CustomEnv</a></span><span> = <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <a href="../Env/index.html">Env</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="../Env/index.html#type-t">t</a> = <a href="../Env/index.html#type-t">Env.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-MakeTypeChecker" class="anchored"><a href="#module-MakeTypeChecker" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="MakeTypeChecker/index.html">MakeTypeChecker</a></span><span> (<a href="MakeTypeChecker/argument-1-E/index.html">E</a> : <a href="module-type-CustomEnv/index.html">CustomEnv</a>) : <a href="module-type-S/index.html">S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-S/index.html#type-t">t</a> = unit</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-MakeSignatureBuilder" class="anchored"><a href="#module-MakeSignatureBuilder" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="MakeSignatureBuilder/index.html">MakeSignatureBuilder</a></span><span> (<a href="MakeSignatureBuilder/argument-1-E/index.html">E</a> : <a href="module-type-CustomEnv/index.html">CustomEnv</a>) : <a href="module-type-S/index.html">S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-S/index.html#type-t">t</a> = <a href="../../Kernel/Signature/index.html#type-t">Kernel.Signature.t</a></span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-MakeEntryPrinter" class="anchored"><a href="#module-MakeEntryPrinter" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="MakeEntryPrinter/index.html">MakeEntryPrinter</a></span><span> (<a href="MakeEntryPrinter/argument-1-E/index.html">E</a> : <a href="module-type-CustomEnv/index.html">CustomEnv</a>) : <a href="module-type-S/index.html">S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-S/index.html#type-t">t</a> = unit</span></span></code></div></div><div class="odoc-spec"><div class="spec module" id="module-MakeDependencies" class="anchored"><a href="#module-MakeDependencies" class="anchor"></a><code><span><span class="keyword">module</span> </span><span><a href="MakeDependencies/index.html">MakeDependencies</a></span><span> (<a href="MakeDependencies/argument-1-E/index.html">E</a> : <a href="module-type-CustomEnv/index.html">CustomEnv</a>) : <a href="module-type-S/index.html">S</a> <span class="keyword">with</span> <span><span class="keyword">type</span> <a href="module-type-S/index.html#type-t">t</a> = <a href="../Dep/index.html#type-t">Dep.t</a></span></span></code></div></div></div></body></html>